<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Classements Smash Betting</title>
    <style>
        body { 
            font-family: sans-serif; 
            margin: 20px; 
            background-color: #f4f4f9; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
            gap: 40px; 
        }
        .classement-container {
            display: flex;
            justify-content: center;
            gap: 40px;
            width: 90%;
            max-width: 1200px;
        }
        .classement-box { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            flex: 1; /* Permet aux bo√Ætes de se redimensionner */
        }
        #bonus-ranking-box {
             flex: 2; /* Donne plus de place au classement d√©taill√© des bonus */
        }
        h2 { 
            color: #007bff; 
            border-bottom: 2px solid #007bff; 
            padding-bottom: 5px; 
            margin-top: 0;
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 15px; 
        }
        th, td { 
            padding: 10px; 
            text-align: left; 
            border-bottom: 1px solid #ddd; 
        }
        th { 
            background-color: #f2f2f2; 
        }
        tr:nth-child(even) { 
            background-color: #f9f9f9; 
        }
        .rank-1 { background-color: gold !important; font-weight: bold; }
        .rank-2 { background-color: silver !important; font-weight: bold; }
        .rank-3 { background-color: #cd7f32 !important; color: white; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Classements Smash Betting</h1>

    <div class="classement-container">
        
        <div class="classement-box" id="points-ranking-box">
            <h2>üèÜ Classement G√©n√©ral des Points</h2>
            <table id="classement-points">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Utilisateur</th>
                        <th>Points</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>

        <div class="classement-box" id="bonus-ranking-box">
            <h2>‚ú® Classement des Bonus par Type</h2>
            <table id="classement-bonus">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Utilisateur</th>
                        <th>Global</th>
                        <th>LU</th>
                        <th>LD</th>
                        <th>CP</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const apiBaseUrl = window.location.origin;

        function applyRankClass(row, rank) {
            if (rank === 1) row.className = 'rank-1';
            else if (rank === 2) row.className = 'rank-2';
            else if (rank === 3) row.className = 'rank-3';
        }

        // Fonction pour afficher le classement des points
        function fetchAndDisplayPoints() {
            fetch(`${apiBaseUrl}/api/classement/points`)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('classement-points').querySelector('tbody');
                    tableBody.innerHTML = '';

                    data.forEach((item, index) => {
                        const row = tableBody.insertRow();
                        const rank = index + 1;
                        
                        applyRankClass(row, rank);

                        row.insertCell().textContent = rank;
                        row.insertCell().textContent = item.username;
                        row.insertCell().textContent = item.totalPoints;
                    });
                })
                .catch(error => {
                    console.error(`Erreur lors du chargement du classement des points:`, error);
                });
        }
        
        // Fonction pour afficher le classement des bonus (avec les colonnes LU, LD, CP)
        function fetchAndDisplayBonus() {
            fetch(`${apiBaseUrl}/api/classement/bonus`)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('classement-bonus').querySelector('tbody');
                    tableBody.innerHTML = '';

                    data.forEach((item, index) => {
                        const row = tableBody.insertRow();
                        const rank = index + 1;
                        
                        applyRankClass(row, rank);

                        row.insertCell().textContent = rank;
                        row.insertCell().textContent = item.username;
                        row.insertCell().textContent = item.bonusUsedCount; // Global
                        row.insertCell().textContent = item.luCount || 0;    // LU
                        row.insertCell().textContent = item.ldCount || 0;    // LD
                        row.insertCell().textContent = item.cpCount || 0;    // CP
                    });
                })
                .catch(error => {
                    console.error(`Erreur lors du chargement du classement des bonus:`, error);
                });
        }

        function refreshClassements() {
            fetchAndDisplayPoints();
            fetchAndDisplayBonus();
        }

        document.addEventListener('DOMContentLoaded', refreshClassements);
        
        // Rafra√Æchissement automatique toutes les 30 secondes
        setInterval(refreshClassements, 30000); 
    </script>

</body>
</html>